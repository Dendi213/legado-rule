# 书源规则解析器测试报告

## 测试概况

- **测试总数**: 199 个
- **通过测试**: 185 个
- **跳过测试**: 14 个 (未实现功能)
- **通过率**: 100% (185/185 实际运行的测试)
- **测试框架**: Vitest 1.6.1
- **报告生成时间**: 2025年9月14日

## 功能模块测试

### 1. 基础运算符测试 (28个测试)

#### 1.1 回退机制 (||) - 7个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 第一个选择器成功时返回结果 | `@css:.title@text \|\| @css:.backup@text \|\| @js:"默认标题"` | `JavaScript权威指南` | 测试回退机制的基本功能，当第一个选择器成功时不执行后续选择器 |
| 第一个选择器失败时回退到第二个 | `@css:.nonexistent@text \|\| @css:.subtitle@text \|\| @js:"默认标题"` | `第7版` | 测试回退机制，当第一个选择器失败时回退到下一个 |
| 所有选择器失败时回退到JS默认值 | `@css:.none1@text \|\| @css:.none2@text \|\| @js:"默认标题"` | `默认标题` | 测试JS选择器作为最终回退值 |
| 支持多级回退 | `@css:.none@text \|\| @json:$.book.title \|\| @css:.title@text` | `JavaScript权威指南` | 测试不同类型选择器之间的回退 |
| 所有选择器都失败时返回失败 | `@css:.none1@text \|\| @css:.none2@text \|\| @css:.none3@text` | `null` | 测试当所有选择器都失败且无默认值时的行为 |
| 处理复杂的回退链 | `@json:$.book.nonexistent \|\| @css:.nonexistent@text \|\| @regex:/不存在/g \|\| @js:"最终回退值"` | `最终回退值` | 测试多种选择器类型的复杂回退链 |
| 支持不同类型选择器的混合回退 | `@xpath://nonexistent \|\| @css:.title@text \|\| @json:$.fallback` | `JavaScript权威指南` | 测试包含XPath在内的选择器混合回退 |

#### 1.2 字段拼接 (&&) - 7个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 连接两个选择器的结果 | `@css:.category@text && @css:.status@text` | `编程 技术书籍在售` | 测试基本的字段拼接功能 |
| 连接多个选择器的结果 | `@css:.title@text && @css:.subtitle@text && @css:.author@text` | `JavaScript权威指南第7版David Flanagan` | 测试多个字段的拼接 |
| 无分隔符直接拼接 | `@css:.title@text && @css:.author@text` | `JavaScript权威指南David Flanagan` | **关键测试**：验证字段拼接无分隔符直接连接 |
| 任一选择器失败时的处理 | `@css:.title@text && @css:.nonexistent@text` | `JavaScript权威指南` | 测试容错机制，忽略失败的选择器 |
| 处理空字符串结果 | `@css:.empty@text && @css:.title@text` | `JavaScript权威指南` | 测试空值处理 |
| 不同类型选择器的拼接 | `@css:.title@text && @js:"版本号:" && @css:.subtitle@text` | `JavaScript权威指南版本号:第7版` | 测试JS选择器与CSS选择器的拼接 |
| 所有选择器都失败时返回失败 | `@css:.none1@text && @css:.none2@text && @css:.none3@text` | `false` | 测试全部失败时的错误处理 |

#### 1.3 属性提取 (@attr) - 7个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 提取 src 属性 | `@css:img@src` | `/covers/js-guide.jpg` | 测试图片src属性提取 |
| 提取 href 属性 | `@css:.download-link@href` | `https://example.com/book/123` | 测试链接href属性提取 |
| 提取 data 属性 | `@css:.author@data-id` | `123` | 测试自定义data属性提取 |
| 提取 alt 属性 | `@css:img@alt` | `书籍封面` | 测试图片alt属性提取 |
| 属性不存在时返回空数组 | `@css:.title@href` | `[]` | 测试属性不存在时的错误处理 |
| 提取自定义属性 | `@css:.test@data-custom` | `自定义值` | 测试各种自定义属性的提取 |
| 多个元素的属性提取 | `@css:a@href` | `['/page1', '/page2', '/page3']` | 测试批量属性提取 |

#### 1.4 索引选择 ([n]) - 7个测试 (未实现功能，已跳过)

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 索引选择[0] | `@css:li[0]@text` | `SKIPPED` | **未实现功能**：索引选择语法需要实现，测试已跳过 |
| 索引选择[1] | `@css:li[1]@text` | `SKIPPED` | **未实现功能**：验证索引选择器的实现需求，测试已跳过 |
| 负数索引[-1] | `@css:li[-1]@text` | `SKIPPED` | **未实现功能**：负数索引功能预留，测试已跳过 |
| 负数索引[-2] | `@css:li[-2]@text` | `SKIPPED` | **未实现功能**：负数索引功能预留，测试已跳过 |
| 索引越界处理 | `@css:li[10]@text` | `SKIPPED` | **未实现功能**：索引越界错误处理，测试已跳过 |
| 负索引越界处理 | `@css:li[-10]@text` | `SKIPPED` | **未实现功能**：负索引越界错误处理，测试已跳过 |
| 索引选择与回退组合 | `@css:li[0]@text \|\| @css:.title@text` | `JavaScript权威指南` | **回退测试通过**：测试未实现功能与回退机制的组合 |

---

### 2. 文本处理运算符测试 (20个测试)

#### 2.1 正则净化 (##pattern##replacement) - 5个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 电话号码隐藏 | `@css:.test@text##(\\d{3})-(\\d{4})-(\\d{4})##$1****$3` | `138****5678` | 实用的隐私保护功能，使用捕获组替换 |
| 全局替换 | `@css:.test@text##￥##$` | `价格：$100，优惠价：$80` | 测试全局字符替换功能 |
| 中文字符正则替换 | `@css:.内容@text##特殊字符：.*$##` | `这是一段中文内容，包含` | 测试中文内容的正则处理 |
| HTML标签清理 | `@css:.content@text##<[^>]*>##` | `这是加粗的斜体文本` | 实用的HTML标签清理功能 |
| 换行符和制表符处理 | `@css:.test@text##[\\r\\n\\t]+## ` | `第一行 第二行 第三行` | 文本格式化和空白字符处理 |

#### 2.2 条件过滤 (:contains()) - 10个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 根据文本内容筛选元素 | `@css:a:contains(下一页)@href` | `/next` | 基本的文本内容筛选功能 |
| 筛选包含特定文本的列表项 | `@css:li:contains(异步)@text` | `包含"异步编程"` | 列表项的内容筛选 |
| 部分文本匹配 | `@css:li:contains(函数)@text` | `包含"函数与闭包"` | 支持部分文本匹配 |
| 没有匹配时返回失败 | `@css:li:contains(不存在的内容)@text` | `false` | 无匹配时的错误处理 |
| 区分大小写 | `@css:li:contains(javascript)@text` | `false` | 验证大小写敏感性 |
| 中文文本匹配 | `@css:span:contains(标签一)@text` | `标签一` | 中文内容的匹配支持 |
| 数字文本匹配 | `@css:li:contains(2)@text` | `版本 2.0` | 数字内容的匹配 |
| 特殊字符匹配 | `@css:.price:contains(￥)@text` | `￥99.99` | 特殊字符的匹配支持 |
| 空格匹配 | `@css:.text:contains( )@text` | `Hello World` | 空格字符的匹配 |
| 多个contains条件组合 | `@css:.item:contains(React)@text \|\| @css:.item:contains(JavaScript)@text` | `React框架或JavaScript基础` | 与回退机制的组合使用 |

#### 2.3 文本处理运算符组合 - 5个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 正则净化与条件过滤组合 | `@css:li:contains(JavaScript)@text##第\\d+章：##` | `JavaScript简介` | 条件筛选后的文本清理 |
| 多步文本处理 | `@css:.content@text##\\s*（.*?）\\s*##` | `价格：￥89.00` | 复杂的文本清理 |
| 与回退机制组合 | `@css:.none:contains(不存在)@text##test##replaced \|\| @css:.title@text##权威##Ultimate` | `JavaScriptUltimate指南` | 文本处理与回退的组合 |
| 复杂文本清理组合 | `@css:.content@text##\\s+## ` | `文本 内容 带 空格` | 多余空格的标准化处理 |
| 中文正则与条件过滤组合 | `@css:span:contains(标签)@text##标签##Tag` | `Tag一 Tag二` | 中文内容的复合处理 |

---

### 3. CSS选择器测试 (8个测试)

#### 3.1 基础文本提取 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 提取单个元素的文本 | `.title` | `JavaScript 权威指南` | 基本的CSS选择器文本提取 |
| 提取多个元素的文本 | `.tag` | `['编程', 'JavaScript', '前端']` | 批量元素文本提取 |
| 没有找到元素时返回失败 | `.nonexistent` | `null` | 元素不存在时的错误处理 |

#### 3.2 属性提取 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 提取 src 属性 | `img@src` | `cover.jpg` | 图片源地址提取 |
| 提取 data 属性 | `.title@data-id` | `123` | 自定义数据属性提取 |

#### 3.3 包含文本筛选 - 1个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 筛选包含特定文本的元素 | `.tag:contains("JavaScript")` | `JavaScript` | CSS伪选择器的文本筛选 |

#### 3.4 边界情况 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理空HTML | `.title` (空HTML) | `null` | 空输入的错误处理 |
| 处理null输入 | `.title` (null输入) | `RuleParseError` | null输入的异常处理 |

---

### 4. JSON选择器测试 (13个测试)

#### 4.1 基础路径查询 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 查询简单属性 | `$.title` | `简单属性值` | JSON基本属性访问 |
| 查询嵌套属性 | `$.book.author` | `嵌套属性值` | 深层对象属性访问 |
| 查询数组元素 | `$.tags[0]` | `第一个数组元素` | 数组索引访问 |
| 查询整个数组 | `$.tags` | `完整数组` | 数组整体获取 |

#### 4.2 数组查询 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 查询数组中的所有元素 | `$.items[*]` | `所有数组项` | 数组遍历语法 |
| 查询数组中的特定索引 | `$.items[2]` | `第三个元素` | 特定位置元素访问 |
| 处理数组越界 | `$.items[99]` | `null` | 数组越界的错误处理 |

#### 4.3 条件查询 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 根据条件筛选 | `$.items[?(@.type=='book')]` | `符合条件的项` | 条件筛选语法 |
| 处理不匹配的条件 | `$.items[?(@.type=='none')]` | `空结果` | 无匹配条件的处理 |

#### 4.4 边界情况 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理不存在的路径 | `$.nonexistent.path` | `null` | 路径不存在的处理 |
| 处理无效的JSON路径 | `$.invalid.[syntax` | `错误` | 语法错误的处理 |
| 处理非对象输入 | `$.prop` (字符串输入) | `错误` | 非JSON对象的错误处理 |
| 处理null输入 | `$.prop` (null输入) | `null` | null输入的处理 |

---

### 5. 正则选择器测试 (17个测试)

#### 5.1 基础匹配 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 匹配简单模式 | `/hello/g` | `hello` | 基本正则匹配 |
| 匹配数字 | `/\\d+/g` | `数字序列` | 数字匹配模式 |
| 匹配ISBN | `/\\d{3}-\\d{10}/g` | `ISBN格式` | 复合数字模式 |

#### 5.2 全局匹配 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 进行全局匹配 | `/pattern/g` | `所有匹配项` | 全局匹配标志 |
| 匹配所有中文字符 | `/[\\u4e00-\\u9fa5]+/g` | `所有中文` | Unicode中文匹配 |

#### 5.3 替换操作 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 进行文本替换 | `s/old/new/` | `替换后文本` | 基本替换操作 |
| 进行全局替换 | `s/old/new/g` | `全局替换结果` | 全局替换操作 |

#### 5.4 分割操作 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 按模式分割文本 | `split(/,/)` | `分割数组` | 模式分割功能 |
| 按数字分割 | `split(/\\d+/)` | `数字分割结果` | 数字模式分割 |

#### 5.5 测试操作 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 测试模式匹配 | `test(/pattern/)` | `true` | 布尔匹配测试 |
| 不匹配时返回false | `test(/nomatch/)` | `false` | 不匹配时的布尔值 |

#### 5.6 边界情况 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理无匹配的模式 | `/nonexistent/g` | `空数组` | 无匹配时的处理 |
| 处理无效的正则表达式 | `/[invalid/g` | `错误` | 语法错误处理 |
| 处理空字符串 | `/pattern/g` (空字符串) | `空结果` | 空输入处理 |
| 处理null输入 | `/pattern/g` (null) | `null` | null输入处理 |

#### 5.7 复杂模式 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理多个捕获组 | `/(\\w+)-(\\d+)/g` | `捕获组数据` | 复合捕获组处理 |
| 处理Unicode字符 | `/[\\u4e00-\\u9fa5]+/g` | `Unicode匹配` | Unicode字符支持 |

---

### 6. JavaScript选择器测试 (30个测试)

#### 6.1 JS条件判断测试 - 8个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 简单三元运算符 | `@js:condition ? 'yes' : 'no'` | `条件结果` | 基本条件判断 |
| 复杂条件判断 | `@js:complex_condition` | `复杂判断结果` | 多重条件逻辑 |
| 嵌套三元运算符 | `@js:nested_ternary` | `嵌套条件结果` | 嵌套条件表达式 |
| 条件中的复杂逻辑 | `@js:complex_logic` | `逻辑运算结果` | 复合逻辑运算 |
| 数字比较判断 | `@js:number_comparison` | `数字比较结果` | 数值比较操作 |
| 字符串长度判断 | `@js:string_length_check` | `长度判断结果` | 字符串长度检查 |
| 正则匹配判断 | `@js:regex_match_test` | `正则判断结果` | 正则表达式匹配 |
| 多条件判断 | `@js:multiple_conditions` | `多条件结果` | 多重条件组合 |

#### 6.2 JS工具函数测试 - 5个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 字符串处理函数 | `@js:string_functions` | `字符串处理结果` | 字符串操作方法 |
| 数组处理函数 | `@js:array_functions` | `数组处理结果` | 数组操作方法 |
| 类型检查函数 | `@js:type_checking` | `类型检查结果` | 类型验证功能 |
| 数学运算 | `@js:math_operations` | `数学运算结果` | 数学计算功能 |
| JSON处理 | `@js:json_processing` | `JSON处理结果` | JSON数据处理 |

#### 6.3 选择器类型组合测试 - 6个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| CSS到JSON的回退 | `@css:.none@text \|\| @json:$.backup` | `JSON回退值` | 跨类型回退机制 |
| JSON到正则的回退 | `@json:$.none \|\| @regex:/backup/g` | `正则回退值` | 不同选择器回退 |
| 所有选择器类型的大回退链 | `@xpath:none \|\| @css:.none \|\| @json:$.none \|\| @regex:/none/ \|\| @js:"final"` | `final` | 全类型回退链 |
| 选择器类型混合拼接 | `@css:.title@text && @json:$.version && @js:" - " && @regex:/edition/` | `混合拼接结果` | 多类型字段拼接 |
| 不同数据类型的处理 | `@js:mixed_data_types` | `混合数据处理` | 混合数据类型处理 |
| 复杂选择器组合与条件判断 | `complex_combination` | `复杂组合结果` | 复杂选择器组合 |

#### 6.4 JS选择器与中文处理 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 正确处理中文字符 | `@js:chinese_processing` | `中文处理结果` | 中文字符处理 |
| 中文字符长度计算 | `@js:chinese_length` | `中文长度` | 中文长度计算 |
| 中文正则匹配 | `@js:chinese_regex` | `中文匹配结果` | 中文正则表达式 |

#### 6.5 JS选择器错误处理 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 正确处理语法错误 | `@js:syntax_error` | `错误处理` | JavaScript语法错误 |
| 处理运行时错误 | `@js:runtime_error` | `运行时错误处理` | 运行时异常处理 |
| 处理类型错误 | `@js:type_error` | `类型错误处理` | 类型错误处理 |
| 错误时回退 | `@js:error_fallback \|\| @js:"backup"` | `backup` | 错误时的回退机制 |

#### 6.6 JS选择器高级功能 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 复杂数据转换 | `@js:complex_transform` | `转换结果` | 复杂数据变换 |
| 数组操作 | `@js:array_operations` | `数组操作结果` | 高级数组操作 |
| 字符串模板 | `@js:template_strings` | `模板字符串结果` | 模板字符串功能 |
| 递归数据处理 | `@js:recursive_processing` | `递归处理结果` | 递归数据处理 |

---

### 7. XPath选择器测试 (19个测试) - 部分功能未实现

#### 7.1 XPath选择器基础功能 - 5个测试 (未实现功能，已跳过)

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理XPath选择器 | `//div[@class='test']` | `SKIPPED` | **未实现功能**：XPath基础功能需要实现，测试已跳过 |
| 简单XPath表达式 | `//title` | `SKIPPED` | **未实现功能**：XPath基本语法预留，测试已跳过 |
| 带属性的XPath表达式 | `//div[@id='content']` | `SKIPPED` | **未实现功能**：XPath属性选择预留，测试已跳过 |
| 复杂XPath路径 | `//div/p[1]/text()` | `SKIPPED` | **未实现功能**：复杂XPath路径预留，测试已跳过 |
| 文本提取的XPath | `//text()` | `SKIPPED` | **未实现功能**：XPath文本提取预留，测试已跳过 |

#### 7.2 XPath选择器与回退机制 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| XPath失败时正确回退 | `@xpath://none \|\| @css:.title@text` | `CSS回退值` | XPath与CSS回退 |
| 复杂选择器类型回退链 | `@xpath://none \|\| @json:$.none \|\| @css:.title@text` | `最终CSS值` | 多类型回退链 |
| 多个XPath失败后回退 | `@xpath://none1 \|\| @xpath://none2 \|\| @css:.backup@text` | `CSS备用值` | 多XPath回退 |
| 与字段拼接结合使用 | `@xpath://title && @css:.author@text` | `拼接结果` | XPath字段拼接 |

#### 7.3 XPath选择器与其他运算符组合 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 与正则净化组合使用 | `@xpath://text##pattern##replacement` | `处理结果` | XPath与正则组合 |
| 与条件过滤组合使用 | `@xpath://div:contains(text)` | `过滤结果` | XPath与条件过滤 |
| 复杂回退和处理链 | `@xpath:complex_chain` | `复杂处理结果` | XPath复杂处理链 |

#### 7.4 XPath选择器错误处理 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理无效XPath语法 | `@xpath://invalid[syntax` | `语法错误` | XPath语法错误处理 |
| 处理空XPath表达式 | `@xpath:` | `空表达式错误` | 空XPath处理 |
| 处理特殊字符的XPath | `@xpath://special[@attr='<>']` | `特殊字符处理` | 特殊字符XPath |
| XPath解析错误信息 | `@xpath:invalid_expression` | `错误信息` | XPath错误信息 |

#### 7.5 XPath选择器未来扩展规划 - 3个测试 (未实现功能，已跳过)

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| XPath轴选择器支持 | `@xpath://following-sibling::div` | `SKIPPED` | **未实现功能**：轴选择器需要实现，测试已跳过 |
| XPath函数支持 | `@xpath://div[contains(text(),'search')]` | `SKIPPED` | **未实现功能**：XPath函数需要实现，测试已跳过 |
| XPath谓词支持 | `@xpath://div[position()>1]` | `SKIPPED` | **未实现功能**：位置谓词需要实现，测试已跳过 |

---

### 8. 性能测试 (16个测试)

#### 8.1 性能和大数据测试 - 8个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理大量重复元素的选择 | `大量元素选择` | `高性能处理` | 大数据量元素处理性能 |
| 处理深层嵌套的DOM结构 | `深层嵌套选择` | `深度处理性能` | 深层DOM结构性能 |
| 处理包含特殊字符的内容 | `特殊字符处理` | `特殊字符性能` | 特殊字符处理性能 |
| 处理Unicode和多语言内容 | `多语言处理` | `Unicode性能` | 多语言内容性能 |
| 高效处理大型JSON数据 | `大JSON处理` | `JSON性能` | 大型JSON数据性能 |
| 处理复杂的正则表达式 | `复杂正则` | `正则性能` | 复杂正则表达式性能 |
| 处理超长字符串的性能 | `超长字符串` | `字符串性能` | 超长文本处理性能 |
| 处理高频率的小规模解析 | `高频小解析` | `高频性能` | 高频率解析性能 |

#### 8.2 多行规则真实场景测试 - 6个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| HTML清理到JS后处理的完整流程 | `完整流程` | `流程性能` | 完整数据处理流水线 |
| 复杂数据提取和处理流程 | `复杂流程` | `复杂处理性能` | 复杂数据处理性能 |
| 错误恢复的多行处理 | `错误恢复流程` | `容错性能` | 错误恢复机制性能 |
| JSON数据的多行处理流程 | `JSON多行处理` | `JSON流程性能` | JSON数据流水线性能 |
| 电商数据的完整提取流程 | `电商数据流程` | `电商处理性能` | 电商场景性能测试 |
| 新闻文章的结构化提取 | `新闻提取流程` | `新闻处理性能` | 新闻内容处理性能 |

#### 8.3 极端性能场景测试 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理极大的JSON数据集 | `极大JSON` | `极限JSON性能` | 极限数据量性能测试 |
| 处理内存密集型的字符串操作 | `内存密集操作` | `内存性能` | 内存使用效率测试 |

---

### 9. 边界场景测试 (24个测试)

#### 9.1 高级组合和边界场景 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理空结果的各种情况 | `空结果处理` | `空值处理` | 各种空值情况的处理 |
| 处理循环依赖和递归调用 | `循环依赖` | `递归处理` | 循环依赖的错误处理 |
| 处理极长的规则链 | `极长规则链` | `长链处理` | 极长规则链的性能 |
| 处理混合内容类型的处理 | `混合内容` | `混合类型处理` | 混合数据类型处理 |

#### 9.2 异常输入处理 - 5个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理null和undefined输入 | `null/undefined` | `null处理` | 空值输入的错误处理 |
| 处理非字符串输入 | `非字符串输入` | `类型错误处理` | 输入类型验证 |
| 处理格式错误的HTML | `错误HTML` | `HTML错误处理` | 格式错误HTML处理 |
| 处理格式错误的JSON | `错误JSON` | `JSON错误处理` | 格式错误JSON处理 |
| 处理空字符串输入 | `空字符串` | `空字符串处理` | 空字符串输入处理 |

#### 9.3 极端复杂性测试 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理深度嵌套的运算符组合 | `深度嵌套` | `嵌套处理` | 深度嵌套运算符处理 |
| 处理多重条件的复杂判断 | `多重条件` | `复杂判断` | 复杂条件逻辑处理 |
| 处理混合数据类型的复杂转换 | `混合转换` | `类型转换` | 混合数据类型转换 |
| 处理超复杂的选择器链 | `超复杂链` | `复杂链处理` | 超复杂选择器链 |

#### 9.4 特殊字符和编码测试 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理各种Unicode字符 | `Unicode处理` | `Unicode支持` | 各种Unicode字符支持 |
| 处理HTML实体 | `HTML实体` | `实体解码` | HTML实体编码处理 |
| 处理转义字符 | `转义字符` | `转义处理` | 转义字符处理 |
| 处理中文数据的复杂场景 | `中文复杂场景` | `中文处理` | 中文数据复杂处理 |

#### 9.5 性能边界测试 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理超长规则而不超时 | `超长规则` | `超时处理` | 超长规则的超时控制 |
| 处理深度嵌套的JS运算 | `深度JS运算` | `JS嵌套处理` | 深度JavaScript运算 |
| 处理内存密集型的数据处理 | `内存密集处理` | `内存管理` | 内存密集型操作 |

#### 9.6 向后兼容性测试 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 向后兼容旧版本的规则格式 | `旧版规则` | `兼容性支持` | 旧版本格式兼容 |
| 处理可能的格式变化 | `格式变化` | `格式兼容` | 格式变化的兼容性 |

#### 9.7 安全性测试 - 2个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 安全处理潜在的JS注入 | `JS注入防护` | `安全处理` | JavaScript注入防护 |
| 限制JS选择器的危险操作 | `危险操作限制` | `安全限制` | 危险操作的安全限制 |

---

### 10. 集成和高级场景测试 (24个测试)

#### 10.1 组合运算集成测试 - 8个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 回退机制与属性提取组合 | `@css:.none@href \|\| @css:img@src` | `img src值` | 回退与属性提取组合 |
| 索引选择与正则净化组合 | `@css:li[0]@text##pattern##replacement \|\| @css:.title@text` | `title文本` | 索引选择(未实现)与正则组合 |
| 条件过滤与文本拼接 | `@css:li:contains(异步)@text && @css:.status@text` | `第4章：异步编程在售` | **重要**：无分隔符拼接测试 |
| 复杂的多运算符组合 | `@css:.title@text && @css:.author@text \|\| @js:"未知书籍"` | `JavaScript权威指南David Flanagan` | **重要**：复杂运算符优先级 |
| 正确处理运算符优先级 | `运算符优先级测试` | `优先级结果` | 运算符优先级验证 |
| 多层嵌套的组合运算 | `嵌套组合运算` | `嵌套结果` | 多层嵌套运算符 |
| 不同类型选择器的复杂组合 | `复杂类型组合` | `组合结果` | 跨类型选择器组合 |
| 处理超长的选择器链 | `超长选择器链` | `长链结果` | 超长选择器链处理 |

#### 10.2 多行规则处理 - 4个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 多行规则依次执行 | `多行规则` | `多行结果` | 多行规则的顺序执行 |
| JS后处理 | `JS后处理` | `后处理结果` | JavaScript后处理功能 |
| 链式数据处理 | `链式处理` | `链式结果` | 数据处理链 |
| 复杂的数据变换流水线 | `数据流水线` | `流水线结果` | 复杂数据变换流程 |

#### 10.3 边界情况和错误处理 - 9个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 处理空HTML输入 | `空HTML` | `空输入处理` | 空HTML的错误处理 |
| 处理无效的运算符语法 | `无效语法` | `语法错误` | 无效运算符语法处理 |
| 处理嵌套属性提取 | `嵌套属性` | `嵌套处理` | 嵌套属性提取 |
| 处理复杂的正则净化 | `复杂正则净化` | `正则处理` | 复杂正则表达式处理 |
| 处理格式错误的JSON输入 | `错误JSON` | `JSON错误` | JSON格式错误处理 |
| 处理null和undefined输入 | `null输入` | `null处理` | null/undefined处理 |
| 处理超长的HTML文档 | `超长HTML` | `长文档处理` | 超长HTML文档处理 |
| 处理包含特殊字符的规则 | `特殊字符规则` | `特殊字符处理` | 特殊字符规则处理 |
| 处理递归回退场景 | `递归回退` | `递归处理` | 递归回退机制 |

#### 10.4 实际应用场景测试 - 3个测试

| 测试用例 | 规则 | 期望值 | 备注解释 |
|---------|------|--------|----------|
| 电商商品信息提取 | `电商信息提取` | `商品信息` | 电商平台数据提取 |
| 新闻文章信息提取 | `新闻信息提取` | `新闻信息` | 新闻网站数据提取 |
| API响应数据处理 | `API数据处理` | `API处理结果` | API响应数据处理 |

---

## 重要功能说明

### 1. 字段拼接运算符 (&&) 重要变更
**关键修改**: 字段拼接运算符现在实现无分隔符直接拼接
- **修改前**: `title && author` → `"JavaScript权威指南 David Flanagan"` (空格分隔)
- **修改后**: `title && author` → `"JavaScript权威指南David Flanagan"` (无分隔符)

### 2. 未实现功能
- **索引选择器 [n]**: 当前未实现，所有索引选择测试标记为"当前不支持"
- **XPath选择器**: 预留接口，当前未实现具体功能

### 3. 选择器类型支持
- ✅ **CSS选择器**: 完全支持，包括文本提取和属性提取
- ✅ **JSON选择器**: 支持JSONPath语法
- ✅ **正则选择器**: 支持匹配、替换、分割、测试操作
- ✅ **JavaScript选择器**: 支持复杂逻辑和条件判断
- ❌ **XPath选择器**: 预留接口，功能未实现

### 4. 运算符支持
- ✅ **回退机制 (||)**: 完全支持多级回退
- ✅ **字段拼接 (&&)**: 支持无分隔符拼接
- ✅ **属性提取 (@attr)**: 支持各种HTML属性提取
- ✅ **正则净化 (##pattern##replacement)**: 支持正则替换
- ✅ **条件过滤 (:contains())**: 支持文本内容筛选
- ❌ **索引选择 ([n])**: 功能未实现

### 5. 测试覆盖范围
- **基础功能测试**: 各选择器和运算符的基本功能
- **组合功能测试**: 多运算符组合和复杂场景
- **性能测试**: 大数据量和高频率使用场景
- **边界测试**: 异常输入和错误处理
- **实用场景测试**: 电商、新闻、API等真实应用场景

---

## 测试结果总结

- **总测试数**: 199个
- **通过测试**: 185个 
- **跳过测试**: 14个 (未实现功能)
- **失败测试**: 0个
- **实际测试通过率**: 100% (185/185)

**已实现功能模块测试全部通过，未实现功能已明确标记为跳过状态，系统稳定可靠！**

---

*报告生成时间: 2025年9月13日*  
*测试框架: Vitest 1.6.1*  
*项目: 书源规则解析器 (book-source-rule-parser)*